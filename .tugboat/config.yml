services:

  php:
    image: tugboatqa/php:7-apache
    default: true
    depends: mysql
    commands:
      init:
        - set -x
        - apt-get update
        - apt-get install -y libzip-dev mysql-client
        - pecl install zip
        - docker-php-ext-enable zip
        - mkdir "${TUGBOAT_ROOT}/www"
        - ln -snf "${TUGBOAT_ROOT}/www" "${DOCROOT}"
      
      update:
        - composer create-project craftcms/craft $DOCROOT
        - ${DOCROOT}/craft setup/security-key
        - ${DOCROOT}/craft setup/db-creds --interactive=0 --database=tugboat --user=tugboat --password=tugboat --server=mysql
        - ${DOCROOT}/craft install --interactive=0 --email="${CRAFT_EMAIL}" --username=tugboat --password=${CRAFT_PWD} --siteName="${TUGBOAT_PROJECT}"
 
  mysql:
    image: tugboatqa/mysql:5
    commands:
      init: 
      - set -x
      
